{% extends "base.html" %}
{% block content %}
{% if err == 'not_in_family' %}
  <div class="alert alert-danger">‚ùå ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ‡πÄ‡∏î‡πá‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô</div>
{% endif %}
{% if ok == 'task_created' %}
  <div class="alert alert-success">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>
{% endif %}

<h3 class="text-primary mb-3">Parent Dashboard ‚Äì {{ parent.username }}</h3>

<div class="row">
  <div class="col-md-6">
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-dark text-white">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</div>
      <div class="card-body">
        <form action="/parent/task/create" method="post">
          <input type="hidden" name="parent_id" value="{{ parent.id }}">
          <input name="title" class="form-control mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à" required>
          <textarea name="description" class="form-control mb-2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
          <input name="points" type="number" class="form-control mb-2" placeholder="‡πÅ‡∏ï‡πâ‡∏°">
          <select name="kid_id" class="form-select mb-2">
            {% for k in kids %}<option value="{{ k.id }}">{{ k.username }}</option>{% endfor %}
          </select>
          <button class="btn btn-primary w-100">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-success text-white">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</div>
      <div class="card-body">
        <form action="/parent/reward/add" method="post" enctype="multipart/form-data">
        <input type="hidden" name="parent_id" value="{{ parent.id }}">
          <input name="name" class="form-control mb-2" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•">
          <input name="cost" type="number" class="form-control mb-2" placeholder="‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏Å">
          <input name="description" class="form-control mb-2" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
          <input name="image" type="file" class="form-control mb-2">
          <button class="btn btn-success w-100">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
        </form>
      </div>
    </div>
  </div>
  
  <div class="card mb-3">
    <div class="card-header">üë™ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</div>
    <div class="card-body">
      <form action="/parent/family/create" method="post" class="row g-2 mb-2">
        <input type="hidden" name="pid" value="{{ parent.id }}">
        <div class="col-md-6"><input name="name" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß/‡∏õ‡∏≤‡∏£‡πå‡∏ï‡∏µ‡πâ"></div>
        <div class="col-md-3"><button class="btn btn-dark w-100">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</button></div>
      </form>
      <form action="/parent/family/add-kid" method="post" class="row g-2">
        <input type="hidden" name="pid" value="{{ parent.id }}">
        <div class="col-md-4"><input name="family_code" class="form-control" placeholder="Family Code"></div>
        <div class="col-md-4"><input name="kid_username" class="form-control" placeholder="Kid Username"></div>
        <div class="col-md-3"><button class="btn btn-outline-primary w-100">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß</button></div>
      </form>
    </div>
  </div>

</div>

<h4 class="mt-4 d-flex align-items-center">
  üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  <button class="btn btn-sm btn-outline-secondary ms-2" type="button"
          data-bs-toggle="collapse" data-bs-target="#parentNotiBox">
    ‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢
  </button>
  <form action="/parent/notifications/clear/{{ parent.id }}" method="post" class="ms-2">
    <button class="btn btn-sm btn-outline-primary">‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
  </form>
</h4>

<div class="collapse show" id="parentNotiBox">
  <ul class="list-group mb-3">
    {% for n in notis %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <div>
          <div class="small text-muted">{{ n.created_at }}</div>
          {{ n.message }}
        </div>
        <span class="badge {{ 'bg-secondary' if n.is_read else 'bg-warning text-dark' }}">
          {{ n.type }}
        </span>
      </li>
    {% else %}
      <li class="list-group-item text-muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</li>
    {% endfor %}
  </ul>
</div>


<h4 class="mt-4">üßæ ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)</h4>
<ul class="list-group mb-4">
  {% for r in pending_redeems %}
    <li class="list-group-item d-flex justify-content-between align-items-center">
      ‡∏Ñ‡∏≥‡∏Ç‡∏≠ #{{ r.id }} ‡∏à‡∏≤‡∏Å Kid ID {{ r.kid_id }} (Reward ID {{ r.reward_id }})
      <form action="/parent/redeem/decision/{{ r.id }}" method="post" class="d-flex gap-2">
        <input type="hidden" name="pid" value="{{ parent.id }}">
        <button name="approve" value="yes" class="btn btn-sm btn-success">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
        <button name="approve" value="no" class="btn btn-sm btn-danger">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
      </form>
    </li>
  {% else %}
    <li class="list-group-item text-muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ñ‡πâ‡∏≤‡∏á</li>
  {% endfor %}
</ul>

<h4 class="mt-3">üìö ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
<table class="table table-striped table-hover">
  <thead><tr><th>‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à</th><th>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö</th><th>‡πÅ‡∏ï‡πâ‡∏°</th></tr></thead>
  <tbody>{% for t in tasks %}<tr><td>{{ t.title }}</td><td>{{ t.kid_id }}</td><td>{{ t.points }}</td></tr>{% endfor %}</tbody>
</table>

<a href="/parent/submissions/{{ parent.id }}" class="btn btn-outline-dark w-100">‡∏ï‡∏£‡∏ß‡∏à‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡πá‡∏Å‡∏™‡πà‡∏á</a>
{% endblock %}
