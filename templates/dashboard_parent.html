{% extends "base.html" %}
{% block title %}Parent Dashboard{% endblock %}

{% block content %}

<style>
  .wrap      { max-width: 760px; margin: 28px auto; }
  .card      { background:#fff; border:1px solid #eee; border-radius:14px; padding:24px; box-shadow:0 2px 10px rgba(0,0,0,.04); }
  .h1        { font-size:1.6rem; font-weight:800; margin:0 0 6px; }
  .muted     { color:#6b7280; font-size:.95rem; }
  .hr        { height:1px; background:#eee; margin:18px 0; }
  .row       { display:grid; grid-template-columns:1fr; gap:18px; }
  .btn       { display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; cursor:pointer; text-decoration:none; }
  .btn.sec   { background:#f4f4f5; color:#111; border-color:#e5e7eb; }
  .btn.warn  { background:#f59e0b; border-color:#f59e0b; }
  .btn.out   { background:#fff; color:#ef4444; border-color:#ef4444; }
  .input, select, textarea { width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; outline:none; }
  textarea   { resize:vertical; min-height:80px; }
  .codeBox   { display:flex; gap:10px; align-items:center; justify-content:center; }
  .code      { font-weight:800; font-size:1.25rem; letter-spacing:2px; padding:8px 12px; border:1px dashed #cbd5e1; border-radius:10px; background:#f8fafc; }
  .section h3{ margin:0 0 10px; font-size:1.15rem; }
  .hint      { color:#94a3b8; font-size:.9rem; margin-top:6px; }
</style>

<div class="wrap">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap">
      <div>
        <div class="h1">ยินดีต้อนรับ {{ parent.first_name }}</div>
        <div class="muted">แดชบอร์ดผู้ปกครอง</div>
      </div>
      <a class="btn out" href="/login">ออกจากระบบ</a>
    </div>

    <div class="hr"></div>

    {# ---------- Family code / Create family ---------- #}
    {% if family_code %}
      <div class="section" style="text-align:center">
        <div class="muted">รหัสครอบครัวของคุณ</div>
        <div class="codeBox" style="margin:10px 0 6px">
          <span id="famcode" class="code">{{ family_code }}</span>
          <button class="btn sec" type="button"
                  onclick="navigator.clipboard.writeText(document.getElementById('famcode').innerText)">
            คัดลอก
          </button>
        </div>
        <div class="hint">ให้ Kid ใช้รหัสนี้เพื่อเข้าร่วมครอบครัว</div>
      </div>
    {% else %}
      <div class="section" style="max-width:520px;margin:0 auto;">
        <h3>สร้างครอบครัว</h3>
        <form method="post" action="/parent/{{ pid }}/family/create" class="row">
          <div>
            <label class="muted">ชื่อครอบครัว</label>
            <input class="input" name="family_name" placeholder="ตั้งชื่อบ้านของคุณ" required>
          </div>
          <button class="btn" type="submit">สร้างครอบครัว</button>
        </form>
      </div>
    {% endif %}

    <div class="hr"></div>

    {# ---------- Create Task ---------- #}
    <div class="section">
      <h3>สร้างงานให้ลูก</h3>
      <form method="post" action="/parent/{{ pid }}/task/create" class="row">
        <div>
          <label class="muted">เลือก Kid</label>
          <select class="input" name="kid_id" required>
            <option value="">-- เลือก Kid --</option>
            {% for kid in kids %}
              <option value="{{ kid.id }}">{{ kid.first_name }} (ID: {{ kid.id }})</option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="muted">ชื่อภารกิจ</label>
          <input class="input" name="title" placeholder="เช่น เก็บของเล่น" required>
        </div>
        <div>
          <label class="muted">แต้มที่จะได้</label>
          <input class="input" type="number" name="points" min="0" step="1" placeholder="เช่น 10" required>
        </div>
        <div>
          <label class="muted">รายละเอียดเพิ่มเติม (ถ้ามี)</label>
          <textarea class="input" name="description" placeholder="บอกเพิ่มเติมเล็กน้อย…"></textarea>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn" type="submit">เพิ่มภารกิจ</button>
          <a class="btn sec" href="/parent/submissions/{{ pid }}">ตรวจงานที่ส่งมา</a>
        </div>
      </form>
    </div>

    <div class="hr"></div>
    <a class="btn btn-secondary mb-2" href="{{ request.url_for('parent_redeems_page', pid=pid) }}">ตรวจคำขอแลกรางวัล</a>
    <hr>
    <a class="btn btn-outline-primary mb-2" href="{{ request.url_for('parent_history_page', pid=pid) }}">ประวัติการตรวจงาน</a>
    <hr>
    {# ---------- Create Reward ---------- #}
    <div class="section">
      <h3>เพิ่มของรางวัล</h3>
      <form method="post" action="/parent/{{ pid }}/reward/add" enctype="multipart/form-data" class="row">
        <div>
          <label class="muted">ชื่อของรางวัล</label>
          <input class="input" name="name" placeholder="เช่น ขนมโปรด 1 ชิ้น" required>
        </div>
        <div>
          <label class="muted">แต้มที่ใช้แลก</label>
          <input class="input" type="number" name="cost" min="0" step="1" placeholder="เช่น 50" required>
        </div>
        <div>
          <label class="muted">รายละเอียดเพิ่มเติม (ถ้ามี)</label>
          <textarea class="input" name="description" placeholder="คำอธิบายสั้น ๆ"></textarea>
        </div>
        <div>
          <label class="muted">รูปภาพ (ไม่บังคับ)</label>
          <input class="input" type="file" name="image">
        </div>
        <button class="btn warn" type="submit">เพิ่มรางวัล</button>
      </form>
    </div>

  </div>
</div>

{% endblock %}
